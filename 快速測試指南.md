# 快速測試指南

## 編譯與執行

### 方法 1: 使用批次檔（推薦）
```bash
cd TPT_DYMesTest
Build&Run.bat
```

### 方法 2: 手動編譯
```bash
cd TPT_DYMesTest
go mod tidy
go build -o DYMesTest.exe
DYMesTest.exe
```

## 訪問 Web 介面
開啟瀏覽器訪問：`http://localhost:5179`

---

## 新功能測試

### 測試 1: RSP_STATUS 命令

#### 步驟
1. 確認 TPT 連線狀態為「已連線」
2. 點擊紫色的「📊 RSP_STATUS」按鈕
3. 觀察通訊 Log 區域

#### 預期結果
```
[時間] [命令] RSP_STATUS 命令已發送
[時間] [MES->TPT] {
  "type": "RSP_STATUS",
  "timestamp": "2025-12-29T...",
  "msg_id": "...",
  "work_station_name": "TPT-001"
}
```

---

### 測試 2: 自訂命令

#### 測試案例 A: 發送 "aaa" 命令
1. 在「自訂命令」輸入框輸入：`aaa`
2. 點擊青綠色的「📤 發送自訂命令」按鈕
3. 觀察通訊 Log

**預期結果:**
```
[時間] [命令] 自訂命令已發送 (type: aaa)
[時間] [MES->TPT] {
  "type": "aaa",
  "timestamp": "2025-12-29T...",
  "msg_id": "..."
}
```

#### 測試案例 B: 發送其他命令類型
1. 輸入：`TEST_COMMAND`
2. 點擊發送
3. 檢查 Log 中 type 是否為 "TEST_COMMAND"

#### 測試案例 C: 空白輸入驗證
1. 不輸入任何內容（或只輸入空格）
2. 點擊發送
3. 應該會彈出警告：「請輸入命令類型」

---

## 錯誤處理測試

### 測試未連線狀態
1. 在 TPT 未連線時（TCP 連線狀態為「離線」）
2. 嘗試點擊 RSP_STATUS 或發送自訂命令
3. 應該會顯示錯誤訊息：「TPT is not connected」

---

## UI 元素位置

```
┌─────────────────────────────────────────┐
│  📋 控制面板                             │
├─────────────────────────────────────────┤
│  選擇通道: [下拉選單]                    │
│                                          │
│  START 命令                              │
│  條碼: [_____________]                   │
│  製程: [_____________]                   │
│  資料路徑: [_____________]               │
│  [▶ START]                               │
│                                          │
│  其他命令                                │
│  [⏹ STOP] [⏸ PAUSE] [⏯ RESUME]         │
│  [📊 RSP_STATUS] ← 新增                 │
│                                          │
│  自訂命令 ← 新增                         │
│  命令類型: [_____________]               │
│  [📤 發送自訂命令]                       │
└─────────────────────────────────────────┘
```

---

## 按鈕顏色說明

| 按鈕 | 顏色 | 用途 |
|------|------|------|
| START | 綠色 | 啟動通道 |
| STOP | 紅色 | 停止通道 |
| PAUSE | 橘色 | 暫停通道 |
| RESUME | 藍色 | 恢復通道 |
| RSP_STATUS | 紫色 | 請求狀態 |
| 發送自訂命令 | 青綠色 | 發送自訂命令 |

---

## 常見問題

### Q1: 點擊按鈕沒有反應？
**A:** 檢查瀏覽器的開發者工具（F12）Console 標籤，查看是否有 JavaScript 錯誤。

### Q2: 顯示「TPT is not connected」錯誤？
**A:** 確認 TCP 連線狀態為「已連線」，且 TPT 狀態不是「未連線」。

### Q3: 命令發送後沒有看到 Log？
**A:** 檢查 WebSocket 連線是否正常，頁面右上角應該顯示連線狀態。

### Q4: 自訂命令的 timestamp 格式是什麼？
**A:** ISO 8601 格式，包含 +08:00 時區，例如：`2025-12-29T15:30:00+08:00`

---

## 開發者資訊

### API 端點
- **RSP_STATUS**: `POST /api/cmd/rsp_status`
- **自訂命令**: `POST /api/cmd/user_command`
  - Request Body: `{"type": "命令類型"}`

### 相關檔案
- 前端 HTML: `static/index.html`
- 前端 JS: `static/script.js`
- 前端 CSS: `static/style.css`
- 後端 HTTP: `core/server_http.go`
- 狀態管理: `core/state_manager.go`
